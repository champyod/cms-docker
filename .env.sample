# ======================
# CMS Docker Environment Configuration - VPS Deployment
# ======================
# This file contains all environment variables needed for deploying
# the Contest Management System (CMS) using Docker Compose with Portainer

# ======================
# VPS Network Configuration
# ======================
# Your VPS public IP address (used by Raspberry Pi workers to connect)
VPS_PUBLIC_IP=YOUR_VPS_PUBLIC_IP_HERE
VPS_HOSTNAME=${VPS_PUBLIC_IP}

# ======================
# Database Configuration
# ======================
POSTGRES_DB=cmsdb
POSTGRES_USER=cmsuser
POSTGRES_PASSWORD=changeme123!
POSTGRES_PUBLIC_PORT=5432

# ======================
# CMS Core Configuration
# ======================
# Secret key for web sessions (generate with: python -c 'from cmscommon import crypto; print(crypto.get_hex_random_key())')
CMS_SECRET_KEY=8e045a51e4b102ea803c06f92841a1fb
CMS_TORNADO_DEBUG=false

# ======================
# Public Port Configuration (No Domain)
# ======================
# Contest Web Server (For Participants)
CMS_CONTEST_LISTEN_ADDRESS=0.0.0.0
CMS_CONTEST_LISTEN_PORT=8888
CMS_CONTEST_PUBLIC_PORT=8888
CMS_CONTEST_COOKIE_DURATION=10800

# Admin Web Server (For Administrators) 
CMS_ADMIN_LISTEN_ADDRESS=0.0.0.0
CMS_ADMIN_LISTEN_PORT=8889
CMS_ADMIN_PUBLIC_PORT=8889
CMS_ADMIN_COOKIE_DURATION=36000

# Ranking Web Server (For Scoreboard)
CMS_RANKING_BIND_ADDRESS=0.0.0.0
CMS_RANKING_HTTP_PORT=8890
CMS_RANKING_PUBLIC_PORT=8890
CMS_RANKING_USERNAME=admin
CMS_RANKING_PASSWORD=ranking123!
CMS_RANKING_REALM=Scoreboard
CMS_RANKING_BUFFER_SIZE=100

# ======================
# CMS Service Ports (for Raspberry Pi workers)
# ======================
CMS_LOG_SERVICE_PORT=29000
CMS_RESOURCE_SERVICE_PORT=28000
CMS_SCORING_SERVICE_PORT=28500
CMS_EVALUATION_SERVICE_PORT=25000
CMS_PROXY_SERVICE_PORT=28600

# ======================
# Nginx Configuration (Optional)
# ======================
# Set to false to use direct ports instead of domain routing
USE_NGINX=false
CMS_DOMAIN=localhost
HTTP_PORT=80
HTTPS_PORT=443

# ======================
# Storage Configuration
# ======================
CMS_LOG_DIR=/opt/cms/log
CMS_CACHE_DIR=/opt/cms/cache
CMS_DATA_DIR=/opt/cms/lib
CMS_RUN_DIR=/opt/cms/run
CMS_RANKING_LOG_DIR=/opt/cms/log/ranking
CMS_RANKING_LIB_DIR=/opt/cms/lib/ranking

# ======================
# CMS System Configuration
# ======================
# Number of workers on main VPS (typically 1, more workers on Raspberry Pis)
CMS_NUM_WORKERS=1
CMS_MAX_SUBMISSION_LENGTH=100000
CMS_MAX_INPUT_LENGTH=5000000

# ======================
# Security & Admin Configuration
# ======================
# Database admin credentials (for initial setup)
DB_ROOT_PASSWORD=root_password_123!

# CMS Admin user (created during setup)
CMS_ADMIN_USERNAME=admin
CMS_ADMIN_PASSWORD=admin_password_123!

# ======================
# Future Domain Configuration
# ======================
# When you get a domain, update these:
# FUTURE_DOMAIN=your-domain.com
# USE_NGINX=true
# Then enable nginx profile in docker-compose

# ======================
# Notes for Portainer Deployment:
# ======================
# 1. Replace YOUR_VPS_PUBLIC_IP_HERE with your actual VPS IP
# 2. Change all passwords before deployment
# 3. Access URLs will be:
#    - Contest: http://VPS_IP:8888
#    - Admin: http://VPS_IP:8889
#    - Ranking: http://VPS_IP:8890
# 4. For Raspberry Pi workers, use the setup script with VPS_PUBLIC_IP

# ======================
# Contest Configuration
# ======================
# Auto-create a sample contest on first startup
CMS_AUTO_CREATE_CONTEST=true

# Contest details (only used if auto-create is enabled)
CMS_CONTEST_NAME=Sample Programming Contest
CMS_CONTEST_DESCRIPTION=A sample contest for testing CMS deployment

# Contest schedule (ISO 8601 format)
# Start time - when participants can begin
CMS_CONTEST_START_TIME=2024-01-01T00:00:00
# End time - when contest submissions close
CMS_CONTEST_END_TIME=2024-12-31T23:59:59
# Timezone for contest times
CMS_CONTEST_TIMEZONE=UTC

# Contest ID to auto-select (1 for first contest, null for manual selection)
# Set to specific contest ID if you want to auto-select a particular contest
CMS_CONTEST_ID=1

# Contest programming languages (JSON array format)
CMS_CONTEST_LANGUAGES=["C++17 / g++", "C11 / gcc", "Python 3 / CPython", "Java / JDK"]

# Contest token system (submission throttling)
CMS_CONTEST_TOKEN_MODE=finite
CMS_CONTEST_TOKEN_MAX=100
CMS_CONTEST_TOKEN_MIN_INTERVAL=60
CMS_CONTEST_TOKEN_INITIAL=2
CMS_CONTEST_TOKEN_GEN_NUMBER=1
CMS_CONTEST_TOKEN_GEN_INTERVAL=600

# Contest submission limits
CMS_CONTEST_MAX_SUBMISSIONS=100
CMS_CONTEST_MAX_USER_TESTS=100
CMS_CONTEST_SCORE_PRECISION=2

# ======================
# Advanced Configuration
# ======================
# Number of reverse proxies (nginx, cloudflare, etc.)
CMS_NUM_PROXIES=1

# Local file storage settings
CMS_SUBMIT_LOCAL_COPY=true
CMS_TESTS_LOCAL_COPY=true
CMS_DOCS_PATH=/usr/share/cms/docs

# ======================
# Sandbox & Security Configuration
# ======================
# Keep sandbox directories after execution (useful for debugging)
CMS_KEEP_SANDBOX=false

# Maximum file size contestants can create (in KB, default 1GB)
CMS_SANDBOX_MAX_FILE_SIZE=1048576

# Compilation limits
CMS_COMPILATION_MAX_PROCESSES=1000
CMS_COMPILATION_MAX_TIME=10.0
CMS_COMPILATION_MAX_MEMORY=524288

# Trusted execution limits (for checkers/validators)
CMS_TRUSTED_MAX_PROCESSES=1000
CMS_TRUSTED_MAX_TIME=10.0
CMS_TRUSTED_MAX_MEMORY=4194304

# ======================
# Printing Configuration
# ======================
# Maximum print job size (bytes)
CMS_PRINT_MAX_LENGTH=10000000
# Paper size (A4, Letter, etc.)
CMS_PRINT_PAPER_SIZE=A4
# Print job limits per user
CMS_PRINT_MAX_PAGES=10
CMS_PRINT_MAX_JOBS=10
# Allow PDF printing
CMS_PRINT_PDF_ALLOWED=false

# ======================
# Monitoring Configuration
# ======================
# Prometheus metrics endpoint
CMS_PROMETHEUS_ADDRESS=0.0.0.0
CMS_PROMETHEUS_PORT=8811

# ======================
# Telegram Bot Integration (Optional)
# ======================
# Enable Telegram bot for notifications
CMS_TELEGRAM_ENABLED=false
# Get bot token from @BotFather on Telegram
CMS_TELEGRAM_BOT_TOKEN=
# Chat ID where notifications will be sent
CMS_TELEGRAM_CHAT_ID=
